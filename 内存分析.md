#内存优化
<font color=FF0000 size=7 >由于有些图片截取的区域较大，可能看不清楚上面的字。可以放大查看，Chrome浏览器使用鼠标滚轮+ctrl。</font>

##原因
为什么要进行内存优化？

原因一：频繁GC导致UI线程卡顿

如果程序出现大量的内存分配和释放，就意味着产生了频繁的GC。当GC线程运行时，其他线程会停止工作（包括UI线程），直到GC完成。所以频繁的GC，必然会导致UI线程的卡顿。特别是性能比较差的手机上，尤为明显。
![](QQ截图20160919160146.png)

原因二：内存泄漏

如果程序出现大量的内存分配，而GC无法回收(一般都是因为有强引用在引用该对象，也就是所谓的内存泄漏），那就会导致程序最终因为内存枯竭而崩溃。在程序上的表现，就是抛出OutOfMemory异常。

<font color=FF0000 size=7 >只有出现上面两种情况的时候才需要进行内存分析！</font>

##分析手段
通过AndroidStudio自带的Monitors工具集中的Memory工具来分析。
![Memory](QQ截图20160919105544.png)

##使用Memory工具分析频繁GC

频繁GC在Memory监视工具中的表现是出现了大量锯齿状内存波动。如果没有出现这种类型的波动，就不是频繁的GC了
![](QQ截图20160919160146.png)

###1. 选择要监视的线程
![选择进程](QQ截图20160919172524.png)
###2. 获取内存分配监视报告
![功能](QQ截图20160919173133.png)

1. 手动触发GC![GC](QQ截图20160919173421.png) 
2. 点击监视按钮![检测按钮](QQ截图20160919173345.png)，开始监视，按钮状态变为![](QQ截图20160919173923.png)，再次点击后结束监视
![监视](QQ截图20160919161032.png)

3. 结束监视后会得到结果文件
![](QQ截图20160919161329.png)

###3. 分析监视结果文件

分析过程已经标注在图片上了，也就是图片上的红字

排序
![排序](QQ截图20160919161637.png)

展开
![展开](QQ截图20160919162026.png)

跳转到相应源码
![](QQ截图20160919162118.png)

找到相应代码，并解决
![](QQ截图20160919165522.png)

